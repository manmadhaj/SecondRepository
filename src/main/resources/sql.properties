FONT_STYLE_PIECHART_NAME=DejaVu Sans

queries.fetchReportInputsData = SELECT * FROM PUBLIC.REPORT_INPUTS_INFO_REF  WHERE REPORT_ID = :REPORT_ID

queries.fetchReportInputValues= SELECT SCREEN_URL FROM PUBLIC.SCREENS_REF WHERE ISACTIVE=TRUE AND SCREEN_ID=:SCREEN_ID

queries.forminUrl = SELECT DISPLAY_COLUMN_NM FROM PUBLIC.REPORT_INPUTS_INFO_REF WHERE REPORT_ID IN(SELECT SCREEN_ID FROM PUBLIC.SCREENS_REF WHERE SCREEN_URL=:SERVICE_NAME);

queries.searchChapters = SELECT CHAPTER_ID,DESCRIPTION FROM QUALITY.QUALITY_CHAPTER_REF WHERE DESCRIPTION LIKE :DESCRIPTION||'%' ORDER BY CHAPTER_ID

queries.modulesLookUp = SELECT OMX.MOD_ID,MOD.MOD_NM FROM PUBLIC.ORGANISATION_MODULE_XREF OMX JOIN PUBLIC.MODULES_REF MOD ON OMX.MOD_ID = MOD.MOD_ID WHERE OMX.ORG_ID = :ORG_ID AND MOD.MOD_NM ILIKE :MOD_NM||'%'  ORDER BY OMX.MOD_ID

queries.fetchInvoiceReportData=SELECT TO_CHAR(bh.created_dttm,'DD-MM-YYYY') invoice_date,  bh.invoice_no, bh.hos_patient_id, pir.first_nm AS patient_first_name, bh.patient_category_nm, (SELECT doctor_register_no FROM public.employees_info_ref WHERE emp_id = bh.doctor_id)AS doctor_mic_no, (SELECT first_nm FROM public.employees_info_ref WHERE emp_id = bh.doctor_id) AS doctor_nm, bs.description AS service_nm, bh.invoice_type as bill_from, bh.bill_status, (SELECT first_nm FROM public.employees_info_ref WHERE emp_id = bh.created_usr_id) AS created_user_nm, TO_CHAR(cancel_dttm, 'DD-MM-YYYY') cancel_date, bh.cancel_reason,(SELECT first_nm FROM public.employees_info_ref WHERE emp_id = bh.cancel_usr_id) AS cancel_user_nm,bh.payment_mode, bh.total_invoice_service_amt, bh.total_invoice_discount_amt, bh.total_tax_amt, bh.total_invoice_amt FROM billing.patient_bill_info_trans bh  JOIN billing.patient_bill_services_trans bd ON bh.org_id = bd.org_id AND bh.invoice_no = bd.invoice_no  JOIN patient_info_ref pir ON bh.patient_id = pir.patient_id  JOIN billing.services bs ON bs.service_id = bd.service_id   JOIN department_ref dept ON dept.dept_id = bh.dept_id WHERE bh.org_id = :orgId AND bill_status IN ('A','C') AND bh.created_dttm  BETWEEN  :fromDate AND  :toDate

queries.departmentWisePdfInvoiceDetails=SELECT TO_CHAR(bh.created_dttm,'DD-MM-YYYY') invoice_date, bh.invoice_no, dept.dept_nm, bh.hos_patient_id, pir.first_nm || ' '||COALESCE(pir.last_nm,'') AS patient_name, (SELECT first_nm FROM public.employees_info_ref WHERE emp_id = bh.doctor_id) AS doctor_nm, bh.total_invoice_amt FROM billing.patient_bill_info_trans bh JOIN patient_info_ref pir ON bh.patient_id = pir.patient_id JOIN department_ref dept ON dept.dept_id = bh.dept_id WHERE bh.org_id = :orgId AND bill_status = 'A' AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate

queries.fetchDepartmentTotals=SELECT ROW_NUMBER() OVER (ORDER BY dept.dept_nm) as "S.No", dept.dept_nm, COUNT(bh.invoice_no) as count, SUM(bh.total_invoice_amt) as total FROM billing.patient_bill_info_trans bh JOIN department_ref dept ON dept.dept_id = bh.dept_id WHERE bh.org_id = :orgId AND bill_status = 'A' AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate

queries.fetchDoctorWiseInvoice=SELECT TO_CHAR(bh.created_dttm,'DD-MM-YYYY') invoice_date, bh.invoice_no, dept.dept_nm, bh.hos_patient_id, pir.first_nm || ' '||COALESCE(pir.last_nm,'') AS patient_name, (SELECT first_nm FROM public.employees_info_ref WHERE emp_id = bh.doctor_id) AS doctor_nm, bh.total_invoice_amt FROM billing.patient_bill_info_trans bh JOIN patient_info_ref pir ON bh.patient_id = pir.patient_id JOIN department_ref dept ON dept.dept_id = bh.dept_id WHERE bh.org_id = :orgId AND bill_status = 'A' AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate   

queries.fetchDoctorWiseInvoiceTotals=SELECT ROW_NUMBER() OVER (ORDER BY eir.first_nm) as "S.No", eir.first_nm AS doctor_nm, eir.doctor_register_no, COUNT(bh.invoice_no) as invoice_count, SUM(bh.total_invoice_amt) as invoice_amt FROM billing.patient_bill_info_trans bh JOIN public.employees_info_ref eir ON eir.emp_id = bh.doctor_id  JOIN department_ref dept ON dept.dept_id = bh.dept_id  WHERE bh.org_id = :orgId AND bill_status = 'A' AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate

#Below query is for PDF 
#queries.fetchPaymentModeWiseInvoice=SELECT TO_CHAR(bh.created_dttm,'DD-MM-YYYY') invoice_date, bh.invoice_no, bh.hos_patient_id, pir.first_nm || ' '||COALESCE(pir.last_nm,'') AS patient_name, (SELECT first_nm FROM public.employees_info_ref WHERE emp_id = bh.doctor_id) AS doctor_nm, bpt.payment_mode, bpt.transaction_amt, bh.total_invoice_amt FROM billing.patient_bill_info_trans bh JOIN patient_info_ref pir ON bh.patient_id = pir.patient_id JOIN billing.bill_payment_trans bpt ON bh.org_id = bpt.org_id AND bh.invoice_no = bpt.invoice_no WHERE bh.org_id = :orgId AND bill_status = 'A' AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate

queries.fetchPaymentModeWiseInvoice=SELECT ROW_NUMBER() OVER (ORDER BY BPT.PAYMENT_MODE) AS "S.NO", BPT.PAYMENT_MODE, COUNT(BH.INVOICE_NO), SUM(BH.TOTAL_INVOICE_DISCOUNT_AMT) DISCOUNT_AMT, SUM(BH.TOTAL_INVOICE_DUE_AMT) DUE_AMT, SUM(BPT.TRANSACTION_AMT) TOT_AMT FROM BILLING.PATIENT_BILL_INFO_TRANS BH JOIN BILLING.BILL_PAYMENT_TRANS BPT ON BH.ORG_ID = BPT.ORG_ID AND BH.INVOICE_NO = BPT.INVOICE_NO WHERE BH.ORG_ID = :orgId AND BILL_STATUS = 'A' AND DATE(BH.CREATED_DTTM) BETWEEN :fromDate AND :toDate 

#Below query is for PDF
#queries.fetchPaymentModeWiseInvoiceTotals=SELECT ROW_NUMBER() OVER (ORDER BY bpt.payment_mode) as "S.No", bpt.payment_mode, COUNT(bh.invoice_no), SUM(bpt.transaction_amt) as total FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bpt ON bh.org_id = bpt.org_id AND bh.invoice_no = bpt.invoice_no WHERE bh.org_id = :orgId AND bill_status = 'A' AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate

queries.fetchPaymentModeWiseInvoiceTotals=SELECT TO_CHAR(BH.CREATED_DTTM,'DD-MM-YYYY HH24:MI') INVOICE_DATE, BH.INVOICE_NO, POX.HOS_PATIENT_ID, CONCAT(PIR.FIRST_NM,' ',PIR.LAST_NM) AS PATIENT_NAME, (SELECT CONCAT(FIRST_NM, ' ', LAST_NM) FROM PUBLIC.EMPLOYEES_INFO_REF WHERE EMP_ID = BH.DOCTOR_ID) AS DOCTOR_NM, BH.TOTAL_INVOICE_DISCOUNT_AMT, BH.DISCOUNT_REMARKS, BH.TOTAL_INVOICE_DUE_AMT, BH.INVOICE_DUE_REMARKS, (SELECT CONCAT(FIRST_NM, ' ', LAST_NM) FROM PUBLIC.EMPLOYEES_INFO_REF WHERE EMP_ID = BH.CREATED_USR_ID) AS CREATED_USR_NM, BPT.PAYMENT_MODE, BPT.TRANSACTION_AMT, BH.TOTAL_INVOICE_AMT FROM BILLING.PATIENT_BILL_INFO_TRANS BH JOIN PATIENT_ORGANISATION_XREF POX ON BH.PATIENT_ID = POX.PATIENT_ID AND BH.ORG_ID = POX.ORG_ID JOIN PATIENT_INFO_REF PIR ON BH.PATIENT_ID = PIR.PATIENT_ID JOIN BILLING.BILL_PAYMENT_TRANS BPT ON BH.ORG_ID = BPT.ORG_ID AND BH.INVOICE_NO = BPT.INVOICE_NO WHERE BH.ORG_ID = :orgId AND BILL_STATUS = 'A' AND DATE(BH.CREATED_DTTM) BETWEEN :fromDate AND :toDate 

queries.fetchServiceWiseInvoice=SELECT TO_CHAR(bh.created_dttm,'DD-MM-YYYY') invoice_date, bh.invoice_no,dept.dept_nm, bh.hos_patient_id, pir.first_nm ||' '||COALESCE(pir.last_nm,'') AS patient_first_name, (SELECT first_nm ||' '||COALESCE(last_nm,'') FROM public.employees_info_ref WHERE emp_id = bh.doctor_id) AS doctor_nm, bs.description AS service_nm, bd.total_amt FROM billing.patient_bill_info_trans bh JOIN billing.patient_bill_services_trans bd ON bh.org_id = bd.org_id AND bh.invoice_no = bd.invoice_no JOIN patient_info_ref pir ON bh.patient_id = pir.patient_id JOIN billing.services bs ON bs.service_id = bd.service_id AND bs.org_id = bh.org_id LEFT JOIN department_ref dept ON dept.dept_id = bh.dept_id WHERE bh.org_id = :orgId AND bill_status = 'A' AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate

queries.fetchServiceWiseInvoiceTotals=SELECT ROW_NUMBER() OVER (ORDER BY bs.description) as "S.No", bs.description, COUNT(bh.invoice_no) as count, SUM(bd.total_amt) as total FROM billing.patient_bill_info_trans bh JOIN billing.patient_bill_services_trans bd ON bh.org_id = bd.org_id AND bh.invoice_no = bd.invoice_no JOIN billing.services bs ON bs.service_id = bd.service_id AND bs.org_id = bh.org_id WHERE bh.org_id = :orgId AND bill_status = 'A' AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate     

queries.fetchCancelledInvoice=SELECT TO_CHAR(bh.created_dttm,'DD-MM-YYYY') invoice_date, bh.invoice_no, bh.hos_patient_id, pir.first_nm ||' '||COALESCE(pir.last_nm,'') AS patient_nm, (SELECT first_nm ||' '||COALESCE(last_nm,'') FROM public.employees_info_ref WHERE emp_id = bh.doctor_id) AS doctor_nm, TO_CHAR(cancel_dttm, 'DD-MM-YYYY') cancel_date, (SELECT emp_user_nm FROM public.employees_info_ref WHERE emp_id = bh.cancel_usr_id) AS cancel_user_nm, bh.cancel_reason, bh.total_invoice_amt FROM billing.patient_bill_info_trans bh JOIN patient_info_ref pir ON bh.patient_id = pir.patient_id WHERE bh.org_id = :orgId AND bill_status = 'C' AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate ORDER BY bh.bill_id

queries.fetchCancelledInvoiceTotals=SELECT 1 as "S.No", COUNT(bh.invoice_no), SUM(bh.total_invoice_amt) FROM billing.patient_bill_info_trans bh WHERE bh.org_id = :orgId AND bill_status = 'C' AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate

queries.fetchDoctorWiseDiscount =SELECT TO_CHAR(bh.created_dttm,'DD-MM-YYYY') invoice_date, bh.invoice_no, dept.dept_nm, bh.hos_patient_id, pir.first_nm || ' '||COALESCE(pir.last_nm,'') AS patient_name, (SELECT first_nm FROM public.employees_info_ref WHERE emp_id = bh.doctor_id) AS doctor_nm, bh.total_invoice_amt, bh.total_invoice_discount_amt FROM billing.patient_bill_info_trans bh JOIN patient_info_ref pir ON bh.patient_id = pir.patient_id JOIN department_ref dept ON dept.dept_id = bh.dept_id WHERE bh.org_id = :orgId AND bill_status = 'A' AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate  AND bh.total_invoice_discount_amt > 0 

queries.fetchDoctorWiseDiscountTotals=SELECT ROW_NUMBER() OVER (ORDER BY eir.first_nm) as "S.No", eir.first_nm AS doctor_nm, eir.doctor_register_no, COUNT(bh.invoice_no) as invoice_no_count,SUM(bh.total_invoice_amt) charged_amt, SUM(bh.total_invoice_discount_amt) discount_amt FROM billing.patient_bill_info_trans bh JOIN public.employees_info_ref eir ON eir.emp_id = bh.doctor_id JOIN department_ref dept ON dept.dept_id = bh.dept_id WHERE bh.org_id = :orgId AND bill_status = 'A' AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate AND bh.total_invoice_discount_amt > 0

queries.fetchDoctorWiseTax=SELECT TO_CHAR(bh.created_dttm,'DD-MM-YYYY') invoice_date, bh.invoice_no, dept.dept_nm, bh.hos_patient_id, pir.first_nm || ' '||COALESCE(pir.last_nm,'') AS patient_name, (SELECT first_nm FROM public.employees_info_ref WHERE emp_id = bh.doctor_id) AS doctor_nm, bh.total_cgst_tax_amt, bh.total_sgst_tax_amt, bh.total_invoice_amt FROM billing.patient_bill_info_trans bh JOIN patient_info_ref pir ON bh.patient_id = pir.patient_id JOIN department_ref dept ON dept.dept_id = bh.dept_id WHERE bh.org_id = :orgId AND bill_status = 'A' AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate

queries.fetchDoctorWiseTaxTotals=SELECT ROW_NUMBER() OVER (ORDER BY eir.first_nm) as "S.No", eir.first_nm AS doctor_nm, eir.doctor_register_no, COUNT(bh.invoice_no) as invoice_count, SUM(bh.total_cgst_tax_amt) as cgst_amt, SUM(bh.total_sgst_tax_amt) as sgst_amt, SUM(bh.total_invoice_amt) as charged_amt FROM billing.patient_bill_info_trans bh JOIN public.employees_info_ref eir ON eir.emp_id = bh.doctor_id JOIN department_ref dept ON dept.dept_id = bh.dept_id WHERE bh.org_id = :orgId AND bill_status = 'A' AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate

queries.fetchServiceWiseTax=SELECT TO_CHAR(bh.created_dttm,'DD-MM-YYYY') invoice_date, bh.invoice_no, bh.hos_patient_id, pir.first_nm ||' '||COALESCE(pir.last_nm,'') AS patient_first_name, (SELECT first_nm ||' '||COALESCE(last_nm,'') FROM public.employees_info_ref WHERE emp_id = bh.doctor_id) AS doctor_nm, bs.description AS service_nm, bd.cgst_tax_amt, bd.sgst_tax_amt, bd.total_amt FROM billing.patient_bill_info_trans bh JOIN billing.patient_bill_services_trans bd ON bh.org_id = bd.org_id AND bh.invoice_no = bd.invoice_no JOIN patient_info_ref pir ON bh.patient_id = pir.patient_id JOIN billing.services bs ON bs.service_id = bd.service_id WHERE bh.org_id = :orgId AND bill_status = 'A' AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate

queries.fetchServiceWiseTaxTotals=SELECT ROW_NUMBER() OVER (ORDER BY bs.description) as "S.No", bs.description, COUNT(bh.invoice_no) as invoiceNo, SUM(bd.cgst_tax_amt)as cgst, SUM(bd.sgst_tax_amt) as sgst, SUM(bd.total_amt) as total FROM billing.patient_bill_info_trans bh JOIN billing.patient_bill_services_trans bd ON bh.org_id = bd.org_id AND bh.invoice_no = bd.invoice_no JOIN billing.services bs ON bs.service_id = bd.service_id WHERE bh.org_id = :orgId AND bill_status = 'A' AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate

queries.fetchDepartmentWisePatientConsultation=SELECT TO_CHAR(pvt.visit_dt,'DD-MM-YYYY') visit_date, dept.dept_nm, pvt.appointment_type, pvt.hos_patient_id, pir.first_nm || ' '||COALESCE(pir.last_nm,'') AS patient_name, pir.gender, (SELECT first_nm FROM public.employees_info_ref WHERE emp_id = pvt.doctor_id) AS doctor_nm FROM opd.patient_visit_trans pvt JOIN patient_info_ref pir ON pvt.patient_id = pir.patient_id JOIN department_ref dept ON dept.dept_id = pvt.dept_id WHERE pvt.org_id = :orgId AND pvt.isactive = TRUE AND DATE(pvt.visit_dt) BETWEEN :fromDate AND :toDate

queries.fetchDepartmentWisePatientConsultationTotals=SELECT ROW_NUMBER() OVER (ORDER BY dept.dept_nm) as "S.No", dept.dept_nm, COUNT(pvt.hos_patient_id) patient_count FROM opd.patient_visit_trans pvt JOIN department_ref dept ON dept.dept_id = pvt.dept_id WHERE pvt.org_id = :orgId AND pvt.isactive = TRUE AND DATE(pvt.created_dttm) BETWEEN :fromDate AND :toDate 

queris.fetchDoctorWisePatientConsulation=SELECT TO_CHAR(pvt.visit_dt,'DD-MM-YYYY') visit_date, dept.dept_nm, pvt.appointment_type, pvt.hos_patient_id, pir.first_nm || ' '||COALESCE(pir.last_nm,'') AS patient_name, pir.gender, (SELECT first_nm FROM public.employees_info_ref WHERE emp_id = pvt.doctor_id) AS doctor_nm FROM opd.patient_visit_trans pvt JOIN patient_info_ref pir ON pvt.patient_id = pir.patient_id JOIN department_ref dept ON dept.dept_id = pvt.dept_id WHERE pvt.org_id = :orgId AND pvt.isactive = TRUE AND DATE(pvt.visit_dt) BETWEEN :fromDate AND :toDate 

queris.fetchDoctorWisePatientConsulationTotals=SELECT ROW_NUMBER() OVER (ORDER BY eir.first_nm) as "S.No", eir.first_nm AS doctor_nm, eir.doctor_register_no, COUNT(eir.first_nm) patient_count FROM opd.patient_visit_trans pvt JOIN public.employees_info_ref eir ON eir.emp_id = pvt.doctor_id JOIN department_ref dept ON dept.dept_id = pvt.dept_id WHERE pvt.org_id = :orgId AND pvt.isactive = TRUE AND DATE(pvt.visit_dt) BETWEEN :fromDate AND :toDate 

queries.fetchAppointmentTypeWisePatient=SELECT TO_CHAR(pvt.visit_dt,'DD-MM-YYYY') visit_date, dept.dept_nm, pvt.appointment_type as app_type, pvt.hos_patient_id, pir.first_nm || ' '||COALESCE(pir.last_nm,'') AS patient_name, pir.gender, (SELECT first_nm FROM public.employees_info_ref WHERE emp_id = pvt.doctor_id) AS doctor_nm FROM opd.patient_visit_trans pvt JOIN patient_info_ref pir ON pvt.patient_id = pir.patient_id JOIN department_ref dept ON dept.dept_id = pvt.dept_id WHERE pvt.org_id = :orgId AND pvt.isactive = TRUE AND DATE(pvt.visit_dt) BETWEEN :fromDate AND :toDate

queries.fetchAppointmentTypeWisePatientTotals=SELECT ROW_NUMBER() OVER (ORDER BY pvt.appointment_type) as "S.No", pvt.appointment_type, COUNT(pvt.appointment_type) appointment_count FROM opd.patient_visit_trans pvt JOIN department_ref dept ON dept.dept_id = pvt.dept_id WHERE pvt.org_id = :orgId AND pvt.isactive = TRUE AND DATE(pvt.visit_dt) BETWEEN :fromDate AND :toDate

queries.fetchPatientBalanceDue=SELECT TO_CHAR(bh.created_dttm,'DD-MM-YYYY') invoice_date, bh.invoice_no, bh.hos_patient_id, pir.first_nm || ' '||COALESCE(pir.last_nm,'') AS patient_name, (current_date - bh.invoice_dt) due_since, bh.total_invoice_amt, bh.total_invoice_due_amt FROM billing.patient_bill_info_trans bh JOIN patient_info_ref pir ON bh.patient_id = pir.patient_id WHERE bh.org_id = :orgId AND bill_status = 'A' AND bh.total_invoice_due_amt > 0 ORDER BY invoice_date

queries.fetchPatientBalanceDueTotals=SELECT ROW_NUMBER() OVER (ORDER BY bh.hos_patient_id) as "S.No", bh.hos_patient_id, pir.first_nm||' '||COALESCE(pir.last_nm,'') AS patient_nm, SUM(bh.total_invoice_due_amt) as invoice_due_amt_sums FROM billing.patient_bill_info_trans bh JOIN patient_info_ref pir ON bh.patient_id = pir.patient_id WHERE bh.org_id = :orgId AND bill_status = 'A' AND bh.total_invoice_due_amt > 0 GROUP BY bh.hos_patient_id, patient_nm ORDER BY bh.hos_patient_id, patient_nm

queries.fetchDoctorWiseAppointmentDetails=SELECT TO_CHAR(PAT.APPOINTMENT_DT,'DD-MM-YYYY') APPOINTMENT_DATE, PAT.HOS_PATIENT_ID, PIR.FIRST_NM || ' '||PIR.LAST_NM AS PATIENT_NAME, PIR.MOBILE_NO, PAT.APPOINTMENT_TYPE, (SELECT FIRST_NM FROM PUBLIC.EMPLOYEES_INFO_REF WHERE EMP_ID = PAT.DOCTOR_ID) AS DOCTOR_NM, SRV.DESCRIPTION SERVICE_NM FROM APPOINTMENT.PATIENT_APPOINTMENT_TRANS PAT JOIN PATIENT_INFO_REF PIR ON PAT.PATIENT_ID = PIR.PATIENT_ID LEFT JOIN BILLING.SERVICES SRV ON SRV.SERVICE_ID = PAT.SERVICE_ID AND SRV.ORG_ID = PAT.ORG_ID WHERE PAT.ORG_ID = :orgId AND PAT.ISACTIVE = TRUE AND DATE(PAT.APPOINTMENT_DT) BETWEEN :fromDate AND :toDate  

queries.fetchDoctorWiseAppointmentDetailsTotals=SELECT ROW_NUMBER() OVER (ORDER BY EIR.FIRST_NM) AS "S.NO", EIR.FIRST_NM AS DOCTOR_NM, EIR.DOCTOR_REGISTER_NO, COUNT(EIR.FIRST_NM) PATIENT_COUNT FROM APPOINTMENT.PATIENT_APPOINTMENT_TRANS PAT JOIN PUBLIC.EMPLOYEES_INFO_REF EIR ON EIR.EMP_ID = PAT.DOCTOR_ID WHERE PAT.ORG_ID = :orgId AND PAT.ISACTIVE = TRUE AND DATE(PAT.APPOINTMENT_DT) BETWEEN :fromDate AND :toDate

queries.userRoleManagement=SELECT CONCAT(EIR.FIRST_NM,' ',EIR.LAST_NM) EMP_NM, M.MOD_NM, R.ROLE_NM, S.SCREEN_NM, S.SCREEN_TYPE, RS.PRIVILEGE_ID FROM PUBLIC.EMPLOYEE_ROLE_XREF ER JOIN EMPLOYEES_INFO_REF EIR ON EIR.EMP_ID = ER.EMP_ID AND EIR.ISACTIVE=TRUE AND EIR.user_type != 'superadmin' JOIN MODULES_REF M ON M.MOD_ID = ER.MOD_ID JOIN ROLES_REF R ON R.ROLE_ID = ER.ROLE_ID AND R.ISACTIVE = TRUE JOIN ROLE_SCREEN_XREF RS ON R.ROLE_ID = RS.ROLE_ID AND RS.ISACTIVE = TRUE JOIN SCREENS_REF S ON S.SCREEN_ID = RS.SCREEN_ID AND S.ISACTIVE=TRUE AND S.MOD_ID = M.MOD_ID WHERE ER.ORG_ID = :orgId AND ER.ROLE_ID NOT IN (1, 2 ) AND ER.ISACTIVE = TRUE  

#queries.fetchUserwiseInvoiceDetails=SELECT PBIT.INVOICE_DT, CONCAT(EIR.FIRST_NM, ' ', EIR.LAST_NM) BILL_USER, CONCAT(PIR.FIRST_NM, ' ', PIR.LAST_NM) PATIENT_NM, HOS_PATIENT_ID, INVOICE_NO, TOTAL_INVOICE_AMT, TOTAL_INVOICE_DUE_AMT FROM BILLING.PATIENT_BILL_INFO_TRANS PBIT JOIN EMPLOYEES_INFO_REF EIR ON PBIT.CREATED_USR_ID = EIR.EMP_ID JOIN PATIENT_INFO_REF PIR ON PIR.PATIENT_ID = PBIT.PATIENT_ID WHERE PBIT.ORG_ID = :orgId AND DELETE_DTTM IS NULL AND CANCEL_DTTM IS NULL  AND DATE(PBIT.INVOICE_DT) BETWEEN :fromDate AND :toDate 

queries.fetchUserwiseInvoiceDetailsTotals=SELECT ROW_NUMBER() OVER (ORDER BY CONCAT(EIR.FIRST_NM, ' ', EIR.LAST_NM)) AS "S.NO", CONCAT(EIR.FIRST_NM, ' ', EIR.LAST_NM) BILL_USER, SUM(TOTAL_INVOICE_AMT) TOTAL_INVOICE_AMT, SUM(TOTAL_INVOICE_DUE_AMT) TOTAL_DUE_AMT FROM BILLING.PATIENT_BILL_INFO_TRANS PBIT JOIN EMPLOYEES_INFO_REF EIR ON PBIT.CREATED_USR_ID = EIR.EMP_ID JOIN PATIENT_INFO_REF PIR ON PIR.PATIENT_ID = PBIT.PATIENT_ID WHERE PBIT.ORG_ID = :orgId AND DELETE_DTTM IS NULL AND CANCEL_DTTM IS NULL AND DATE(PBIT.INVOICE_DT) BETWEEN :fromDate AND :toDate

queries.adminRoleManagement=SELECT DISTINCT MR.MOD_ID mod_id,MR.MOD_NM,RR.ROLE_ID,RR.ROLE_NM role_nm, SR.SCREEN_NM se_nm, RSX.PRIVILEGE_ID PID, 'SCREEN' screen_emp_ind FROM MODULES_REF MR JOIN ROLES_REF RR ON RR.MOD_ID = MR.MOD_ID AND RR.ISACTIVE=TRUE AND RR.ROLE_ID NOT IN (1,2) JOIN SCREENS_REF SR ON SR.MOD_ID = MR.MOD_ID AND SR.ISACTIVE=TRUE JOIN ROLE_SCREEN_XREF RSX ON RSX.SCREEN_ID = SR.SCREEN_ID AND RSX.ROLE_ID = RR.ROLE_ID AND RSX.ISACTIVE=TRUE JOIN EMPLOYEE_ROLE_XREF ERX ON ERX.ROLE_ID = RSX.ROLE_ID AND ERX.MOD_ID = RR.MOD_ID AND ERX.ISACTIVE=TRUE AND ERX.ORG_ID = :orgId WHERE MR.MOD_ID=:modeId AND MR.ISACTIVE=TRUE UNION SELECT MR.MOD_ID mod_id,MR.MOD_NM,RR.ROLE_ID,RR.ROLE_NM role_nm, CONCAT(EIR.FIRST_NM, ' ', EIR.last_nm) se_nm, NULL PID, 'EMPLOYEE' screen_emp_ind FROM MODULES_REF MR JOIN ROLES_REF RR ON RR.MOD_ID = MR.MOD_ID AND RR.ISACTIVE=TRUE AND RR.ROLE_ID NOT IN (1,2) JOIN EMPLOYEE_ROLE_XREF ERX ON ERX.ROLE_ID = RR.ROLE_ID AND ERX.MOD_ID = RR.MOD_ID AND ERX.ISACTIVE=TRUE JOIN EMPLOYEES_INFO_REF EIR ON EIR.EMP_ID=ERX.EMP_ID WHERE MR.MOD_ID=:modeId AND MR.ISACTIVE=TRUE AND ERX.ORG_ID=:orgId order by mod_id, role_nm,screen_emp_ind desc, se_nm

queries.fetchHospitalWardOccupancy=SELECT ORG_WARD.WARD_NM, WARD_TOTAL_BEDS, RIT.ROOM_NO, ORG_WARD.WARD_OCCUPIED_BEDS, WARD_AVAILABLE_BEDS, RIT.ROOM_TYPE, BIT.BED_NO, ADMIT_DT, PATIENT.PATIENT_NM, PATIENT.AGE, PATIENT.GENDER, PATIENT.DOCTOR_NM, TOTAL_BEDS AS HOSPITAL_TOTAL_BEDS, TOTAL_OCCUPIED_BEDS AS HOSPITAL_TOTAL_OCCUPIED_BEDS , TOTAL_AVAILABLE_BEDS AS HOSPITA_TOTAL_AVAILABLE_BEDS FROM (SELECT WIT.ORG_ID, WIT.WARD_ID, WARD_NM, SUM(NO_OF_BEDS) WARD_TOTAL_BEDS, SUM(OCCUPIED_BEDS) WARD_OCCUPIED_BEDS, SUM(AVAILABLE_BEDS) WARD_AVAILABLE_BEDS FROM IPD.WARD_INFO_TRANS WIT JOIN IPD.ROOM_INFO_TRANS RIT ON RIT.WARD_ID = WIT.WARD_ID WHERE WIT.ORG_ID = :ORGID GROUP BY WIT.ORG_ID, WIT.WARD_ID, WARD_NM) ORG_WARD JOIN (SELECT ORG_ID, SUM(NO_OF_BEDS) TOTAL_BEDS, SUM(OCCUPIED_BEDS) TOTAL_OCCUPIED_BEDS, SUM(AVAILABLE_BEDS) TOTAL_AVAILABLE_BEDS FROM IPD.ROOM_INFO_TRANS WHERE ORG_ID = :ORGID GROUP BY ORG_ID ) ORG_BEDS ON ORG_BEDS.ORG_ID = ORG_WARD.ORG_ID JOIN IPD.ROOM_INFO_TRANS RIT ON RIT.WARD_ID = ORG_WARD.WARD_ID JOIN IPD.BED_INFO_TRANS BIT ON BIT.ROOM_ID = RIT.ROOM_ID  JOIN (SELECT PCAT.ORG_ID, TO_CHAR(ADMIT_DT, 'DD-MM-YYYY') ADMIT_DT, CONCAT(PIR.FIRST_NM, ' ', PIR.LAST_NM) PATIENT_NM, PCAT.HOS_PATIENT_ID, PIR.AGE/365 AGE, PIR.GENDER, CONCAT(EIR.FIRST_NM, ' ', EIR.LAST_NM) DOCTOR_NM, PCAT.WARD_ID, PCAT.ROOM_ID, RIT1.ROOM_TYPE, RIT1.ROOM_NO, BIT1.BED_ID, BIT1.BED_NO FROM IPD.PATIENT_CURRENT_ADMIT_TRANS PCAT JOIN EMPLOYEES_INFO_REF EIR ON EIR.EMP_ID = PCAT.DOCTOR_ID JOIN PATIENT_INFO_REF PIR ON PIR.PATIENT_ID = PCAT.PATIENT_ID JOIN IPD.WARD_INFO_TRANS WIT1 ON WIT1.WARD_ID = PCAT.WARD_ID JOIN IPD.ROOM_INFO_TRANS RIT1 ON RIT1.ROOM_ID = PCAT.ROOM_ID JOIN IPD.BED_INFO_TRANS BIT1 ON BIT1.BED_ID = PCAT.BED_ID WHERE PCAT.ORG_ID = :ORGID AND PCAT.ISACTIVE = TRUE AND PCAT.BED_ALLOCATION_CANCEL_DTTM IS NULL ) PATIENT ON PATIENT.WARD_ID = ORG_WARD.WARD_ID AND PATIENT.ROOM_ID = RIT.ROOM_ID AND PATIENT.BED_ID = BIT.BED_ID ORDER BY ORG_WARD.WARD_ID, ROOM_NO, BED_NO 

queries.fetchNearExpiryDrugDetails=SELECT PHINV.DRUG_BRAND_NM, PHINV.DRUG_TYPE_NM, DRUG_NM, AVAILABLE_QTY STOCK_QTY, BATCH_NO, TO_CHAR(EXPIRE_DATE,'DD-MM-YYYY') EXPIRE_DT, ROUND(COST_PRICE * AVAILABLE_QTY/STRIP_KEEPING_UNIT) TOTAL_COST_PRICE FROM PHARMACY.PHARMACY_ORG_STORE_BRAND_INVENTORY_TRANS PHINV JOIN DRUG_BRAND_REF DBR ON DBR.DRUG_BRAND_ID = PHINV.DRUG_BRAND_ID WHERE PHINV.ORG_ID = :orgId AND EXPIRE_DATE BETWEEN :fromDate AND :toDate AND EXPIRE_DATE > CURRENT_DATE AND AVAILABLE_QTY > 0 AND PHINV.ISACTIVE = TRUE ORDER BY EXPIRE_DT, DRUG_BRAND_NM

queries.fetchExpiredDrugDetails=SELECT PHINV.DRUG_BRAND_NM, PHINV.DRUG_TYPE_NM, DRUG_NM, AVAILABLE_QTY STOCK_QTY, BATCH_NO, TO_CHAR(EXPIRE_DATE,'DD-MM-YYYY') EXPIRE_DT, ROUND(COST_PRICE * AVAILABLE_QTY/STRIP_KEEPING_UNIT) TOTAL_COST_PRICE FROM PHARMACY.PHARMACY_ORG_STORE_BRAND_INVENTORY_TRANS PHINV JOIN DRUG_BRAND_REF DBR ON DBR.DRUG_BRAND_ID = PHINV.DRUG_BRAND_ID WHERE PHINV.ORG_ID = :orgId AND EXPIRE_DATE BETWEEN :fromDate AND :toDate AND EXPIRE_DATE < CURRENT_DATE AND AVAILABLE_QTY > 0 AND PHINV.ISACTIVE = TRUE ORDER BY EXPIRE_DT, DRUG_BRAND_NM

queries.fetchPharmacySaleReport=SELECT TO_CHAR(PSI.CREATED_DTTM,'DD-MM-YYYY') AS SALE_DATE ,PSI.PHARMACY_BILL_NO,PATIENT_NAME,COALESCE(INITCAP(FIRST_NM),INITCAP(DOCTOR_NM)) AS DOCTOR, DB.DRUG_BRAND_NM,BATCH_NO,POS_QTY,TOTAL_AMT,CGST_TAX_AMT,SGST_TAX_AMT FROM PHARMACY.PHARMACY_POINT_OF_SALE_INFO_TRANS PSI JOIN PHARMACY.PHARMACY_POINT_OF_SALE_DETAILED_INFO_TRANS PSID ON PSI.POINT_OF_SALE_ID=PSID.POINT_OF_SALE_ID JOIN DRUG_BRAND_REF DB ON PSID.BRAND_ID=DB.DRUG_BRAND_ID LEFT JOIN EMPLOYEES_INFO_REF ON DOCTOR_ID=EMP_ID WHERE PSI.ORG_ID=:orgId AND CAST(PSI.CREATED_DTTM AS DATE) BETWEEN :fromDate AND :toDate      

queries.fetchPaymentModeWiseAdavanceCollection=SELECT TO_CHAR(TRANSACTION_DT, 'DD-MM-YYYY') TRANSACTION_DT, HOS_PATIENT_ID, CONCAT(PIR.FIRST_NM,' ',PIR.LAST_NM) PATIENT_NM, PAYMENT_MODE, RECEIPT_NO, TRANSACTION_AMT FROM BILLING.PATIENT_ADVANCE_PAYMENT_TRANS PAPT JOIN PATIENT_INFO_REF PIR ON PIR.PATIENT_ID = PAPT.PATIENT_ID WHERE ORG_ID = :orgId AND DATE(TRANSACTION_DT) BETWEEN :fromDate AND :toDate  AND TRANSACTION_TYPE = 'Deposit' AND PAPT.ISACTIVE=TRUE AND PAPT.DELETE_USR_ID IS NULL 

queries.fetchPaymentModeWiseAdavanceCollectionTotals=SELECT ROW_NUMBER() OVER (ORDER BY PAPT.PAYMENT_MODE) AS "S.NO", PAPT.PAYMENT_MODE, COUNT(PAPT.RECEIPT_NO) AS COUNT, SUM(PAPT.TRANSACTION_AMT) AS TOTAL_SUM FROM BILLING.PATIENT_ADVANCE_PAYMENT_TRANS PAPT JOIN PATIENT_INFO_REF PIR ON PIR.PATIENT_ID = PAPT.PATIENT_ID WHERE ORG_ID = :orgId AND DATE(TRANSACTION_DT) BETWEEN :fromDate AND :toDate  AND TRANSACTION_TYPE = 'Deposit'  AND PAPT.ISACTIVE=TRUE AND PAPT.DELETE_USR_ID IS NULL

queries.fetchAdvanceCollectionReport=SELECT TO_CHAR(TRANSACTION_DT, 'DD-MM-YYYY') TRANSACTION_DT, INITCAP(CONCAT(EIR.FIRST_NM, ' ', EIR.LAST_NM)) USER_NM, HOS_PATIENT_ID, INITCAP(CONCAT(PIR.FIRST_NM,' ',PIR.LAST_NM)) PATIENT_NM, PAYMENT_MODE, RECEIPT_NO, TRANSACTION_AMT FROM BILLING.PATIENT_ADVANCE_PAYMENT_TRANS PAPT JOIN PATIENT_INFO_REF PIR ON PIR.PATIENT_ID = PAPT.PATIENT_ID JOIN EMPLOYEES_INFO_REF EIR ON PAPT.CREATED_USR_ID = EIR.EMP_ID WHERE PAPT.ORG_ID = :orgId AND DATE(TRANSACTION_DT) BETWEEN :fromDate AND :toDate AND TRANSACTION_TYPE = 'Deposit' AND PAPT.ISACTIVE=TRUE AND PAPT.DELETE_USR_ID IS NULL

queries.fetchAdvanceCollectionReportTotals=SELECT ROW_NUMBER() OVER (ORDER BY CONCAT(EIR.FIRST_NM, ' ', EIR.LAST_NM)) AS "S.NO", CONCAT(EIR.FIRST_NM, ' ', EIR.LAST_NM) USER_NM, COUNT(RECEIPT_NO) TOTALINVOICES,SUM(TRANSACTION_AMT) TOTAL_AMT FROM BILLING.PATIENT_ADVANCE_PAYMENT_TRANS PAPT JOIN EMPLOYEES_INFO_REF EIR ON PAPT.CREATED_USR_ID = EIR.EMP_ID WHERE PAPT.ORG_ID = :orgId AND DATE(TRANSACTION_DT) BETWEEN :fromDate AND :toDate AND TRANSACTION_TYPE = 'Deposit' AND PAPT.ISACTIVE=TRUE AND PAPT.DELETE_USR_ID IS NULL

queries.fetchPatientVisiteDetails=SELECT TO_CHAR(PVT.VISIT_DT, 'DD-MM-YYYY HH24:MI') VISIT_DT, POX.HOS_PATIENT_ID, CONCAT(PIR.FIRST_NM, ' ',PIR.LAST_NM) PATIENT_NM,TO_CHAR(PIR.BIRTH_DT, 'DD-MM-YYYY') BIRTH_DT, PIR.GENDER, PIR.MARITAL_STATUS, CONCAT(EMP.FIRST_NM, ' ', EMP.LAST_NM) DOCTORNM FROM OPD.PATIENT_VISIT_TRANS PVT JOIN PATIENT_ORGANISATION_XREF POX ON POX.PATIENT_ID = PVT.PATIENT_ID AND POX.ORG_ID = PVT.ORG_ID JOIN PATIENT_INFO_REF PIR ON PIR.PATIENT_ID = PVT.PATIENT_ID JOIN PUBLIC.EMPLOYEES_INFO_REF EMP ON EMP.EMP_ID = PVT.DOCTOR_ID WHERE DATE(PVT.VISIT_DT) BETWEEN :fromDate AND :toDate AND PVT.ORG_ID =:orgId AND PVT.ISACTIVE=TRUE ORDER BY PVT.VISIT_DT

queries.fetchIPDSummaryReport=SELECT admit_dt, pox.hos_patient_id, cat.ipd_no, concat(pir.first_nm, ' ', pir.last_nm) patient_nm, (SELECT CONCAT(eir.first_nm, ' ', eir.last_nm) FROM employees_info_ref eir WHERE eir.emp_id = cat.doctor_id) doctor_nm, pvt.ref_doctor_nm, pvt.patient_category_nm, ins.patient_insurance_no as patient_insurance_no, ins.insurance_provider_nm, wit.ward_nm, (SELECT COALESCE(SUM(total_amt),0) FROM ipd.patient_services_trans pst WHERE pst.patient_visit_id = cat.patient_visit_id ) approximate_amt, (SELECT COALESCE(SUM(transaction_amt),0) FROM billing.patient_advance_payment_trans apt WHERE apt.patient_visit_id = cat.patient_visit_id and apt.isactive=true and apt.delete_usr_id is null ) advance_amt FROM ipd.patient_current_admit_trans cat JOIN patient_organisation_xref pox ON pox.patient_id = cat.patient_id AND pox.org_id = cat.org_id JOIN patient_info_ref pir ON pir.patient_id = cat.patient_id JOIN opd.patient_visit_trans pvt ON pvt.patient_visit_id = cat.patient_visit_id JOIN ipd.ward_info_trans wit ON wit.ward_id = cat.ward_id LEFT JOIN (SELECT pid.patient_id, pid.patient_insurance_no, pir.insurance_provider_nm FROM public.patient_insurance_details_trans pid JOIN public.insurance_provider_info_ref pir ON pid.insurance_provider_id = pir.insurance_provider_id AND pid.insurance_payer_type = 'primary') ins ON ins.patient_id = cat.patient_id WHERE cat.org_id = :orgId ORDER BY admit_dt DESC 

queries.fetchAppointmentType=SELECT  ATTRIB_CODE AS APPOINTMENT_TYPE   FROM PUBLIC.COMMON_MASTERS_REF WHERE  MASTER_NM ='APPOINTMENT_TYPE' AND ISACTIVE=TRUE AND LANGUAGE_ID=51 ORDER BY ATTRIB_CODE

queries.fetchReferralDoctorDetails=SELECT  TO_CHAR(BH.CREATED_DTTM,'DD-MM-YYYY') INVOICE_DATE, BH.INVOICE_NO, DEPT.DEPT_NM, BH.HOS_PATIENT_ID, PIR.FIRST_NM || ' '||COALESCE(PIR.LAST_NM,'') AS PATIENT_NAME, (SELECT FIRST_NM FROM PUBLIC.EMPLOYEES_INFO_REF WHERE EMP_ID = BH.DOCTOR_ID) AS DOCTOR_NM, PVT.REF_DOCTOR_NM, BH.TOTAL_INVOICE_AMT FROM BILLING.PATIENT_BILL_INFO_TRANS BH JOIN PATIENT_INFO_REF PIR ON BH.PATIENT_ID = PIR.PATIENT_ID JOIN DEPARTMENT_REF DEPT ON DEPT.DEPT_ID = BH.DEPT_ID JOIN OPD.PATIENT_VISIT_TRANS PVT ON PVT.PATIENT_VISIT_ID = BH.PATIENT_VISIT_ID WHERE BH.ORG_ID = :orgId AND BILL_STATUS = 'A' AND DATE(BH.CREATED_DTTM) BETWEEN :fromDate AND :toDate AND LENGTH(PVT.REF_DOCTOR_NM) > 1 

queries.fetchReferralDoctorDetailsTotals=SELECT ROW_NUMBER() OVER (ORDER BY PVT.REF_DOCTOR_NM) AS "S.NO", PVT.REF_DOCTOR_NM AS REF_DOCTOR_NM, COUNT(BH.INVOICE_NO) AS INVOICE_COUNT, SUM(BH.TOTAL_INVOICE_AMT) AS INVOICE_AMT FROM BILLING.PATIENT_BILL_INFO_TRANS BH JOIN PUBLIC.EMPLOYEES_INFO_REF EIR ON EIR.EMP_ID = BH.DOCTOR_ID JOIN DEPARTMENT_REF DEPT ON DEPT.DEPT_ID = BH.DEPT_ID JOIN OPD.PATIENT_VISIT_TRANS PVT ON PVT.PATIENT_VISIT_ID = BH.PATIENT_VISIT_ID WHERE BH.ORG_ID = :orgId AND BILL_STATUS = 'A' AND DATE(BH.CREATED_DTTM) BETWEEN :fromDate AND :toDate AND LENGTH(PVT.REF_DOCTOR_NM) > 1 

queries.fetchDailyCollectionReport=SELECT dt.reference_dt, (SELECT COALESCE(SUM(ap.transaction_amt),0) FROM billing.patient_advance_payment_trans ap WHERE ap.payment_mode = 'CASH' AND ap.org_id = :orgId And ap.isactive=true and ap.DELETE_USR_ID IS NULL AND DATE(ap.transaction_dt) = dt.reference_dt) adv_cash_amt, (SELECT COALESCE(SUM(ap.transaction_amt),0) FROM billing.patient_advance_payment_trans ap WHERE ap.payment_mode = 'CARD' AND ap.org_id = :orgId And ap.isactive=true and ap.DELETE_USR_ID IS NULL AND DATE(ap.transaction_dt) = dt.reference_dt) adv_card_amt, (SELECT COALESCE(SUM(ap.transaction_amt),0) FROM billing.patient_advance_payment_trans ap WHERE ap.payment_mode = 'CHEQUE' AND ap.org_id = :orgId And ap.isactive=true and ap.DELETE_USR_ID IS NULL AND DATE(ap.transaction_dt) = dt.reference_dt) adv_cheque_amt, (SELECT COALESCE(SUM(ap.transaction_amt),0) FROM billing.patient_advance_payment_trans ap WHERE ap.payment_mode = 'DD' AND ap.org_id = :orgId And ap.isactive=true and ap.DELETE_USR_ID IS NULL AND DATE(ap.transaction_dt) = dt.reference_dt) adv_dd_amt, (SELECT COALESCE(SUM(ap.transaction_amt),0) FROM billing.patient_advance_payment_trans ap WHERE ap.payment_mode NOT IN ('ADVANCE','CASH','CARD','CHEQUE','DD') AND ap.org_id = :orgId And ap.isactive=true and ap.DELETE_USR_ID IS NULL AND DATE(ap.transaction_dt) = dt.reference_dt) adv_other_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'CASH' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bh.invoice_type = 'IPD' AND DATE(bh.created_dttm) = dt.reference_dt) ipd_cash_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'CARD' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bh.invoice_type = 'IPD' AND DATE(bh.created_dttm) = dt.reference_dt) ipd_card_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'CHEQUE' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bh.invoice_type = 'IPD' AND DATE(bh.created_dttm) = dt.reference_dt) ipd_cheque_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'DD' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bh.invoice_type = 'IPD' AND DATE(bh.created_dttm) = dt.reference_dt) ipd_dd_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode NOT IN ('ADVANCE','CASH','CARD','CHEQUE','DD') AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bh.invoice_type = 'IPD' AND DATE(bh.created_dttm) = dt.reference_dt) ipd_other_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'CASH' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bh.invoice_type != 'IPD' AND DATE(bh.created_dttm) = dt.reference_dt) opd_cash_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'CARD' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bh.invoice_type != 'IPD' AND DATE(bh.created_dttm) = dt.reference_dt) opd_card_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'CHEQUE' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bh.invoice_type != 'IPD' AND DATE(bh.created_dttm) = dt.reference_dt) opd_cheque_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'DD' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bh.invoice_type != 'IPD' AND DATE(bh.created_dttm) = dt.reference_dt) opd_dd_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode NOT IN ('ADVANCE','CASH','CARD','CHEQUE','DD') AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bh.invoice_type != 'IPD' AND DATE(bh.created_dttm) = dt.reference_dt) opd_other_amt, (SELECT COALESCE(SUM(pp.transaction_amt),0) FROM pharmacy.pharmacy_point_of_sale_info_trans ph JOIN pharmacy.pharmacy_payment_trans pp ON ph.org_id = pp.org_id AND ph.pharmacy_bill_no = pp.invoice_no AND DATE(ph.created_dttm) = DATE(pp.created_dttm) WHERE pp.payment_mode IN ('CASH') AND ph.org_id = :orgId AND ph.cancel_dttm IS NULL AND DATE(ph.created_dttm) = dt.reference_dt) opd_pharmacy_cash_amt, (SELECT COALESCE(SUM(pp.transaction_amt),0) FROM pharmacy.pharmacy_point_of_sale_info_trans ph JOIN pharmacy.pharmacy_payment_trans pp ON ph.org_id = pp.org_id AND ph.pharmacy_bill_no = pp.invoice_no AND DATE(ph.created_dttm) = DATE(pp.created_dttm) WHERE pp.payment_mode IN ('CARD') AND ph.org_id = :orgId AND ph.cancel_dttm IS NULL AND DATE(ph.created_dttm) = dt.reference_dt) opd_pharmacy_card_amt, ((SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) != DATE(bp.created_dttm) WHERE bp.payment_mode = 'CASH' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND DATE(bp.created_dttm) = dt.reference_dt) + (SELECT COALESCE(SUM(pp.transaction_amt),0) FROM pharmacy.pharmacy_point_of_sale_info_trans ph JOIN pharmacy.pharmacy_payment_trans pp ON ph.org_id = pp.org_id AND ph.pharmacy_bill_no = pp.invoice_no AND DATE(ph.created_dttm) != DATE(pp.created_dttm) WHERE pp.payment_mode IN ('CASH') AND ph.org_id = :orgId AND ph.cancel_dttm IS NULL AND DATE(pp.created_dttm) = dt.reference_dt)) old_due_cash_amt, ((SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) != DATE(bp.created_dttm) WHERE bp.payment_mode = 'CARD' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND DATE(bp.created_dttm) = dt.reference_dt) + (SELECT COALESCE(SUM(pp.transaction_amt),0) FROM pharmacy.pharmacy_point_of_sale_info_trans ph JOIN pharmacy.pharmacy_payment_trans pp ON ph.org_id = pp.org_id AND ph.pharmacy_bill_no = pp.invoice_no AND DATE(ph.created_dttm) != DATE(pp.created_dttm) WHERE pp.payment_mode IN ('CARD') AND ph.org_id = :orgId AND ph.cancel_dttm IS NULL AND DATE(pp.created_dttm) = dt.reference_dt)) old_due_card_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) != DATE(bp.created_dttm) WHERE bp.payment_mode = 'CHEQUE' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND DATE(bp.created_dttm) = dt.reference_dt) old_due_cheque_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) != DATE(bp.created_dttm) WHERE bp.payment_mode = 'DD' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND DATE(bp.created_dttm) = dt.reference_dt) old_due_dd_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) != DATE(bp.created_dttm) WHERE bp.payment_mode NOT IN ('ADVANCE','CASH','CARD','CHEQUE','DD') AND bh.org_id = :orgId AND bh.bill_status = 'A' AND DATE(bp.created_dttm) = dt.reference_dt) old_due_other_amt, ((SELECT COALESCE(SUM(bh.total_invoice_due_amt),0) FROM billing.patient_bill_info_trans bh WHERE bh.org_id = :orgId AND bh.bill_status = 'A' AND DATE(bh.created_dttm) < dt.reference_dt) + (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) != DATE(bp.created_dttm) WHERE bh.org_id = :orgId AND bh.bill_status = 'A' AND DATE(bp.created_dttm) = dt.reference_dt + 1) + (SELECT COALESCE(SUM(ph.total_bill_due_amt),0) FROM pharmacy.pharmacy_point_of_sale_info_trans ph WHERE ph.org_id = :orgId AND ph.cancel_dttm IS NULL AND DATE(ph.created_dttm) < dt.reference_dt) + (SELECT COALESCE(SUM(pp.transaction_amt),0) FROM pharmacy.pharmacy_point_of_sale_info_trans ph JOIN pharmacy.pharmacy_payment_trans pp ON ph.org_id = pp.org_id AND ph.pharmacy_bill_no = pp.invoice_no AND DATE(ph.created_dttm) != DATE(pp.created_dttm) WHERE ph.org_id = :orgId AND ph.cancel_dttm IS NULL AND DATE(pp.created_dttm) = dt.reference_dt + 1)) old_pending_due, ((SELECT COALESCE(SUM(bh.total_invoice_due_amt),0) FROM billing.patient_bill_info_trans bh WHERE bh.org_id = :orgId AND bh.bill_status = 'A' AND DATE(bh.created_dttm) = dt.reference_dt) + (SELECT COALESCE(SUM(ph.total_bill_due_amt),0) FROM pharmacy.pharmacy_point_of_sale_info_trans ph WHERE ph.org_id = :orgId AND ph.cancel_dttm IS NULL AND DATE(ph.created_dttm) = dt.reference_dt)) today_due FROM date_ref dt WHERE dt.reference_dt BETWEEN :fromDate AND :toDate GROUP BY dt.reference_dt;

queries.fetchDailyCollectionReportSummary=SELECT ROW_NUMBER() OVER (ORDER BY CONCAT(EIR.FIRST_NM, ' ', EIR.LAST_NM)) AS "S.NO", CONCAT(eir.first_nm, ' ',eir.last_nm) emp_nm, (SELECT COALESCE(SUM(ap.transaction_amt),0) FROM billing.patient_advance_payment_trans ap WHERE ap.payment_mode = 'CASH' AND ap.org_id = :orgId and ap.isactive=true and ap.delete_usr_id is null AND ap.created_usr_id = eir.emp_id AND DATE(ap.transaction_dt) BETWEEN :fromDate AND :toDate) adv_cash_amt, (SELECT COALESCE(SUM(ap.transaction_amt),0) FROM billing.patient_advance_payment_trans ap WHERE ap.payment_mode = 'CARD' AND ap.org_id = :orgId and ap.isactive=true and ap.delete_usr_id is null AND ap.created_usr_id = eir.emp_id AND DATE(ap.transaction_dt) BETWEEN :fromDate AND :toDate) adv_card_amt, (SELECT COALESCE(SUM(ap.transaction_amt),0) FROM billing.patient_advance_payment_trans ap WHERE ap.payment_mode = 'CHEQUE' AND ap.org_id = :orgId and ap.isactive=true and ap.delete_usr_id is null AND ap.created_usr_id = eir.emp_id AND DATE(ap.transaction_dt) BETWEEN :fromDate AND :toDate) adv_cheque_amt, (SELECT COALESCE(SUM(ap.transaction_amt),0) FROM billing.patient_advance_payment_trans ap WHERE ap.payment_mode = 'DD' AND ap.org_id = :orgId and ap.isactive=true and ap.delete_usr_id is null AND ap.created_usr_id = eir.emp_id AND DATE(ap.transaction_dt) BETWEEN :fromDate AND :toDate) adv_dd_amt, (SELECT COALESCE(SUM(ap.transaction_amt),0) FROM billing.patient_advance_payment_trans ap WHERE ap.payment_mode NOT IN ('Advance','CASH','CARD','CHEQUE','DD') AND ap.org_id = :orgId and ap.isactive=true and ap.delete_usr_id is null AND ap.created_usr_id = eir.emp_id AND DATE(ap.transaction_dt) BETWEEN :fromDate AND :toDate) adv_other_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'CASH' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bh.invoice_type = 'IPD' AND bh.created_usr_id = eir.emp_id AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate) ipd_cash_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'CARD' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bh.invoice_type = 'IPD' AND bh.created_usr_id = eir.emp_id AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate) ipd_card_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'CHEQUE' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bh.invoice_type = 'IPD' AND bh.created_usr_id = eir.emp_id AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate) ipd_cheque_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'DD' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bh.invoice_type = 'IPD' AND bh.created_usr_id = eir.emp_id AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate) ipd_dd_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode NOT IN ('Advance','CASH','CARD','CHEQUE','DD') AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bh.invoice_type = 'IPD' AND bh.created_usr_id = eir.emp_id AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate) ipd_other_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'CASH' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bh.invoice_type != 'IPD' AND bh.created_usr_id = eir.emp_id AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate) opd_cash_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'CARD' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bh.invoice_type != 'IPD' AND bh.created_usr_id = eir.emp_id AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate) opd_card_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'CHEQUE' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bh.invoice_type != 'IPD' AND bh.created_usr_id = eir.emp_id AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate) opd_cheque_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'DD' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bh.invoice_type != 'IPD' AND bh.created_usr_id = eir.emp_id AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate) opd_dd_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode NOT IN ('Advance','CASH','CARD','CHEQUE','DD') AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bh.invoice_type != 'IPD' AND bh.created_usr_id = eir.emp_id AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate) opd_other_amt, (SELECT COALESCE(SUM(pp.transaction_amt),0) FROM pharmacy.pharmacy_point_of_sale_info_trans ph JOIN pharmacy.pharmacy_payment_trans pp ON ph.org_id = pp.org_id AND ph.pharmacy_bill_no = pp.invoice_no AND DATE(ph.created_dttm) = DATE(pp.created_dttm) WHERE pp.payment_mode IN ('CASH') AND ph.org_id = :orgId AND ph.cancel_dttm IS NULL AND ph.created_usr_id = eir.emp_id AND DATE(ph.created_dttm) BETWEEN :fromDate AND :toDate) opd_pharmacy_cash_amt, (SELECT COALESCE(SUM(pp.transaction_amt),0) FROM pharmacy.pharmacy_point_of_sale_info_trans ph JOIN pharmacy.pharmacy_payment_trans pp ON ph.org_id = pp.org_id AND ph.pharmacy_bill_no = pp.invoice_no AND DATE(ph.created_dttm) = DATE(pp.created_dttm) WHERE pp.payment_mode IN ('CARD') AND ph.org_id = :orgId AND ph.cancel_dttm IS NULL AND ph.created_usr_id = eir.emp_id AND DATE(ph.created_dttm) BETWEEN :fromDate AND :toDate) opd_pharmacy_card_amt, ((SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) < DATE(bp.created_dttm) WHERE bp.payment_mode = 'CASH' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bp.created_usr_id = eir.emp_id AND DATE(bp.created_dttm) BETWEEN :fromDate AND :toDate) + (SELECT COALESCE(SUM(pp.transaction_amt),0) FROM pharmacy.pharmacy_point_of_sale_info_trans ph JOIN pharmacy.pharmacy_payment_trans pp ON ph.org_id = pp.org_id AND ph.pharmacy_bill_no = pp.invoice_no AND DATE(ph.created_dttm) < DATE(pp.created_dttm) WHERE pp.payment_mode IN ('CASH') AND ph.org_id = :orgId AND ph.cancel_dttm IS NULL AND pp.created_usr_id = eir.emp_id AND DATE(pp.created_dttm) BETWEEN :fromDate AND :toDate)) old_due_cash_amt, ((SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) < DATE(bp.created_dttm) WHERE bp.payment_mode = 'CARD' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bp.created_usr_id = eir.emp_id AND DATE(bp.created_dttm) BETWEEN :fromDate AND :toDate) + (SELECT COALESCE(SUM(pp.transaction_amt),0) FROM pharmacy.pharmacy_point_of_sale_info_trans ph JOIN pharmacy.pharmacy_payment_trans pp ON ph.org_id = pp.org_id AND ph.pharmacy_bill_no = pp.invoice_no AND DATE(ph.created_dttm) < DATE(pp.created_dttm) WHERE pp.payment_mode IN ('CARD') AND ph.org_id = :orgId AND ph.cancel_dttm IS NULL AND pp.created_usr_id = eir.emp_id AND DATE(pp.created_dttm) BETWEEN :fromDate AND :toDate)) old_due_card_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) < DATE(bp.created_dttm) WHERE bp.payment_mode = 'CHEQUE' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bp.created_usr_id = eir.emp_id AND DATE(bp.created_dttm) BETWEEN :fromDate AND :toDate) old_due_cheque_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) < DATE(bp.created_dttm) WHERE bp.payment_mode = 'DD' AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bp.created_usr_id = eir.emp_id AND DATE(bp.created_dttm) BETWEEN :fromDate AND :toDate) old_due_dd_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) < DATE(bp.created_dttm) WHERE bp.payment_mode NOT IN ('Advance','CASH','CARD','CHEQUE','DD') AND bh.org_id = :orgId AND bh.bill_status = 'A' AND bp.created_usr_id = eir.emp_id AND DATE(bp.created_dttm) BETWEEN :fromDate AND :toDate) old_due_other_amt, (SELECT COALESCE(SUM(bh.total_invoice_due_amt),0) FROM billing.patient_bill_info_trans bh WHERE bh.org_id = :orgId AND bh.bill_status = 'A' AND bh.created_usr_id = eir.emp_id AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate) today_due FROM employees_info_ref eir, (SELECT DISTINCT created_usr_id FROM billing.patient_advance_payment_trans WHERE org_id = :orgId and isactive=true and delete_usr_id is null AND DATE(transaction_dt) BETWEEN :fromDate AND :toDate UNION SELECT DISTINCT created_usr_id FROM billing.patient_bill_info_trans WHERE org_id = :orgId AND bill_status = 'A' AND invoice_dt BETWEEN :fromDate AND :toDate UNION SELECT DISTINCT created_usr_id FROM billing.bill_payment_trans WHERE org_id = :orgId AND DATE(transaction_dt) BETWEEN :fromDate AND :toDate UNION SELECT DISTINCT created_usr_id FROM pharmacy.pharmacy_point_of_sale_info_trans WHERE org_id = :orgId AND cancel_dttm IS NULL AND DATE(created_dttm) BETWEEN :fromDate AND :toDate UNION SELECT DISTINCT created_usr_id FROM pharmacy.pharmacy_payment_trans WHERE org_id = :orgId AND DATE(transaction_dt) BETWEEN :fromDate AND :toDate) users WHERE eir.emp_id = users.created_usr_id GROUP BY emp_nm, emp_id ORDER BY emp_nm;
#SELECT ROW_NUMBER() OVER (ORDER BY CONCAT(EIR.FIRST_NM, ' ', EIR.LAST_NM)) AS "S.NO", CONCAT(eir.first_nm, ' ',eir.last_nm) emp_nm, (SELECT COALESCE(SUM(ap.transaction_amt),0) FROM billing.patient_advance_payment_trans ap WHERE ap.payment_mode = 'CASH' AND ap.org_id = :orgId AND ap.created_usr_id = eir.emp_id AND DATE(ap.transaction_dt) BETWEEN :fromDate AND :toDate) adv_cash_amt, (SELECT COALESCE(SUM(ap.transaction_amt),0) FROM billing.patient_advance_payment_trans ap WHERE ap.payment_mode = 'CARD' AND ap.org_id = :orgId AND ap.created_usr_id = eir.emp_id AND DATE(ap.transaction_dt) BETWEEN :fromDate AND :toDate) adv_card_amt, (SELECT COALESCE(SUM(ap.transaction_amt),0) FROM billing.patient_advance_payment_trans ap WHERE ap.payment_mode = 'CHEQUE' AND ap.org_id = :orgId AND ap.created_usr_id = eir.emp_id AND DATE(ap.transaction_dt) BETWEEN :fromDate AND :toDate) adv_cheque_amt, (SELECT COALESCE(SUM(ap.transaction_amt),0) FROM billing.patient_advance_payment_trans ap WHERE ap.payment_mode = 'DD' AND ap.org_id = :orgId AND ap.created_usr_id = eir.emp_id AND DATE(ap.transaction_dt) BETWEEN :fromDate AND :toDate) adv_dd_amt, (SELECT COALESCE(SUM(ap.transaction_amt),0) FROM billing.patient_advance_payment_trans ap WHERE ap.payment_mode NOT IN ('Advance','CASH','CARD','CHEQUE','DD') AND ap.org_id = :orgId AND ap.created_usr_id = eir.emp_id AND DATE(ap.transaction_dt) BETWEEN :fromDate AND :toDate) adv_other_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'CASH' AND bh.org_id = :orgId AND bh.invoice_type = 'IPD' AND bh.created_usr_id = eir.emp_id AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate) ipd_cash_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'CARD' AND bh.org_id = :orgId AND bh.invoice_type = 'IPD' AND bh.created_usr_id = eir.emp_id AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate) ipd_card_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'CHEQUE' AND bh.org_id = :orgId AND bh.invoice_type = 'IPD' AND bh.created_usr_id = eir.emp_id AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate) ipd_cheque_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'DD' AND bh.org_id = :orgId AND bh.invoice_type = 'IPD' AND bh.created_usr_id = eir.emp_id AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate) ipd_dd_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode NOT IN ('Advance','CASH','CARD','CHEQUE','DD') AND bh.org_id = :orgId AND bh.invoice_type = 'IPD' AND bh.created_usr_id = eir.emp_id AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate) ipd_other_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'CASH' AND bh.org_id = :orgId AND bh.invoice_type != 'IPD' AND bh.created_usr_id = eir.emp_id AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate) opd_cash_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'CARD' AND bh.org_id = :orgId AND bh.invoice_type != 'IPD' AND bh.created_usr_id = eir.emp_id AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate) opd_card_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'CHEQUE' AND bh.org_id = :orgId AND bh.invoice_type != 'IPD' AND bh.created_usr_id = eir.emp_id AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate) opd_cheque_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode = 'DD' AND bh.org_id = :orgId AND bh.invoice_type != 'IPD' AND bh.created_usr_id = eir.emp_id AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate) opd_dd_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) = DATE(bp.created_dttm) WHERE bp.payment_mode NOT IN ('Advance','CASH','CARD','CHEQUE','DD') AND bh.org_id = :orgId AND bh.invoice_type != 'IPD' AND bh.created_usr_id = eir.emp_id AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate) opd_other_amt, (SELECT COALESCE(SUM(pp.transaction_amt),0) FROM pharmacy.pharmacy_point_of_sale_info_trans ph JOIN pharmacy.pharmacy_payment_trans pp ON ph.org_id = pp.org_id AND ph.pharmacy_bill_no = pp.invoice_no AND DATE(ph.created_dttm) = DATE(pp.created_dttm) WHERE pp.payment_mode IN ('CASH') AND ph.org_id = :orgId AND ph.created_usr_id = eir.emp_id AND DATE(ph.created_dttm) BETWEEN :fromDate AND :toDate) opd_pharmacy_cash_amt, (SELECT COALESCE(SUM(pp.transaction_amt),0) FROM pharmacy.pharmacy_point_of_sale_info_trans ph JOIN pharmacy.pharmacy_payment_trans pp ON ph.org_id = pp.org_id AND ph.pharmacy_bill_no = pp.invoice_no AND DATE(ph.created_dttm) = DATE(pp.created_dttm) WHERE pp.payment_mode IN ('CARD') AND ph.org_id = :orgId AND ph.created_usr_id = eir.emp_id AND DATE(ph.created_dttm) BETWEEN :fromDate AND :toDate) opd_pharmacy_card_amt, ((SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) < DATE(bp.created_dttm) WHERE bp.payment_mode = 'CASH' AND bh.org_id = :orgId AND bp.created_usr_id = eir.emp_id AND DATE(bp.created_dttm) BETWEEN :fromDate AND :toDate) + (SELECT COALESCE(SUM(pp.transaction_amt),0) FROM pharmacy.pharmacy_point_of_sale_info_trans ph JOIN pharmacy.pharmacy_payment_trans pp ON ph.org_id = pp.org_id AND ph.pharmacy_bill_no = pp.invoice_no AND DATE(ph.created_dttm) < DATE(pp.created_dttm) WHERE pp.payment_mode IN ('CASH') AND ph.org_id = :orgId AND pp.created_usr_id = eir.emp_id AND DATE(pp.created_dttm) BETWEEN :fromDate AND :toDate)) old_due_cash_amt, ((SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) < DATE(bp.created_dttm) WHERE bp.payment_mode = 'CARD' AND bh.org_id = :orgId AND bp.created_usr_id = eir.emp_id AND DATE(bp.created_dttm) BETWEEN :fromDate AND :toDate) + (SELECT COALESCE(SUM(pp.transaction_amt),0) FROM pharmacy.pharmacy_point_of_sale_info_trans ph JOIN pharmacy.pharmacy_payment_trans pp ON ph.org_id = pp.org_id AND ph.pharmacy_bill_no = pp.invoice_no AND DATE(ph.created_dttm) < DATE(pp.created_dttm) WHERE pp.payment_mode IN ('CARD') AND ph.org_id = :orgId AND pp.created_usr_id = eir.emp_id AND DATE(pp.created_dttm) BETWEEN :fromDate AND :toDate)) old_due_card_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) < DATE(bp.created_dttm) WHERE bp.payment_mode = 'CHEQUE' AND bh.org_id = :orgId AND bp.created_usr_id = eir.emp_id AND DATE(bp.created_dttm) BETWEEN :fromDate AND :toDate) old_due_cheque_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) < DATE(bp.created_dttm) WHERE bp.payment_mode = 'DD' AND bh.org_id = :orgId AND bp.created_usr_id = eir.emp_id AND DATE(bp.created_dttm) BETWEEN :fromDate AND :toDate) old_due_dd_amt, (SELECT COALESCE(SUM(bp.transaction_amt),0) FROM billing.patient_bill_info_trans bh JOIN billing.bill_payment_trans bp ON bh.org_id = bp.org_id AND bh.invoice_no = bp.invoice_no AND DATE(bh.created_dttm) < DATE(bp.created_dttm) WHERE bp.payment_mode NOT IN ('Advance','CASH','CARD','CHEQUE','DD') AND bh.org_id = :orgId AND bp.created_usr_id = eir.emp_id AND DATE(bp.created_dttm) BETWEEN :fromDate AND :toDate) old_due_other_amt, (SELECT COALESCE(SUM(bh.total_invoice_due_amt),0) FROM billing.patient_bill_info_trans bh WHERE bh.org_id = :orgId AND bh.created_usr_id = eir.emp_id AND DATE(bh.created_dttm) BETWEEN :fromDate AND :toDate) today_due FROM employees_info_ref eir, (SELECT DISTINCT created_usr_id FROM billing.patient_advance_payment_trans WHERE org_id = :orgId AND DATE(transaction_dt) BETWEEN :fromDate AND :toDate UNION SELECT DISTINCT created_usr_id FROM billing.patient_bill_info_trans WHERE org_id = :orgId AND invoice_dt BETWEEN :fromDate AND :toDate UNION SELECT DISTINCT created_usr_id FROM billing.bill_payment_trans WHERE org_id = :orgId AND DATE(transaction_dt) BETWEEN :fromDate AND :toDate UNION SELECT DISTINCT created_usr_id FROM pharmacy.pharmacy_point_of_sale_info_trans WHERE org_id = :orgId AND DATE(created_dttm) BETWEEN :fromDate AND :toDate UNION SELECT DISTINCT created_usr_id FROM pharmacy.pharmacy_payment_trans WHERE org_id = :orgId AND DATE(transaction_dt) BETWEEN :fromDate AND :toDate) users WHERE eir.emp_id = users.created_usr_id GROUP BY emp_nm, emp_id ORDER BY emp_nm

queries.fetchDailyDischargeSummery=SELECT pat.ipd_no, CONCAT(pir.first_nm, ' ', pir.last_nm) patient_nm, COALESCE(pir.age/365, (current_date - pir.birth_dt)/365) age, pir.gender, pir.mobile_no, CONCAT(pir.address_line1, ' ',pir.address_line2, ' ', pir.city_nm) address, TO_CHAR(pat.admit_dt,'DD-MM-YYYY HH24:MI')admit_dt, TO_CHAR(pat.discharge_dt,'DD-MM-YYYY HH24:MI')discharge_dt, ward.ward_nm, room.room_no, bed.bed_no, bh.total_invoice_due_amt, bh.invoice_due_remarks, bh.discount_remarks, dept.dept_nm, CONCAT(eir.first_nm, ' ', eir.last_nm) UserName, (bh.total_invoice_amt + bh.total_invoice_discount_amt) gross_amt, (bh.total_invoice_amt - bh.total_invoice_due_amt) receipt_amt, bh.total_invoice_discount_amt discount_amt FROM ipd.patient_admit_trans pat JOIN patient_info_ref pir ON pir.patient_id = pat.patient_id JOIN billing.patient_bill_info_trans bh ON bh.patient_visit_id = pat.patient_visit_id AND bh.patient_id = pat.patient_id AND bh.org_id = pat.org_id AND bh.admit_dt IS NOT NULL JOIN ipd.ward_info_trans ward ON ward.ward_id = pat.ward_id JOIN ipd.room_info_trans room ON room.room_id = pat.room_id JOIN ipd.bed_info_trans bed ON bed.bed_id = pat.bed_id JOIN employees_info_ref eir ON eir.emp_id = bh.created_usr_id JOIN department_ref dept ON dept.dept_id = pat.dept_id WHERE pat.org_id = :orgId AND pat.discharge_dt IS NOT NULL AND DATE(pat.discharge_dt) BETWEEN :fromDate AND :toDate

queries.queryForFetchDayWiseCollections=SELECT SUM (TOTAL_INVOICE_AMT),DATE(CREATED_DTTM) DATE FROM  BILLING.PATIENT_BILL_INFO_TRANS WHERE ORG_ID=:ORG_ID  AND CAST(CREATED_DTTM  AS DATE) BETWEEN :CURRENT_DT :: DATE - INTERVAL '7DAYS' AND :CURRENT_DT AND CANCEL_REASON IS NULL GROUP BY DATE(CREATED_DTTM)  ORDER BY DATE(CREATED_DTTM);

queries.queryToFetchDayWisePatientCount=SELECT COUNT (*),DATE(CREATED_DTTM) DATE FROM PUBLIC.PATIENT_ORGANISATION_XREF WHERE ORG_ID=:ORG_ID  AND CAST(CREATED_DTTM  AS DATE) BETWEEN :CURRENT_DT :: DATE - INTERVAL '7DAYS' AND :CURRENT_DT GROUP BY DATE(CREATED_DTTM) ORDER BY DATE(CREATED_DTTM);

queries.queryToFetchMonthWisePatientCount=SELECT COUNT (*),TO_CHAR(CREATED_DTTM, 'YYYY-MON') MONTHS,TO_CHAR(CREATED_DTTM, 'MM') MM,TO_CHAR(CREATED_DTTM, 'YYYY') YEARS FROM PUBLIC.PATIENT_ORGANISATION_XREF WHERE ORG_ID=:ORG_ID AND TO_CHAR(CREATED_DTTM, 'YYYY-MM-DD')::DATE BETWEEN :CURRENT_MONTH::DATE- INTERVAL '1 YEAR'  AND :CURRENT_MONTH::DATE GROUP BY MONTHS,MM,YEARS ORDER BY YEARS,MM;

queries.queryToFetchDayWisePatientVisitCount=SELECT COUNT (*),DATE(CREATED_DTTM) DATE FROM OPD.PATIENT_VISIT_TRANS WHERE ORG_ID=:ORG_ID  AND CAST(CREATED_DTTM  AS DATE) BETWEEN :CURRENT_DT :: DATE - INTERVAL '7DAYS' AND :CURRENT_DT GROUP BY DATE(CREATED_DTTM) ORDER BY DATE(CREATED_DTTM);

queries.queryForFetchMonthWiseCollections=SELECT SUM (TOTAL_INVOICE_AMT), TO_CHAR(CREATED_DTTM, 'YYYY-MON') MONTHS,TO_CHAR(CREATED_DTTM, 'MM') MM,TO_CHAR(CREATED_DTTM, 'YYYY') YEARS FROM  BILLING.PATIENT_BILL_INFO_TRANS WHERE ORG_ID=:ORG_ID AND CANCEL_REASON IS NULL AND TO_CHAR(CREATED_DTTM :: DATE ,'YYYY-MM') <= TO_CHAR(:CURRENT_DT :: DATE ,'YYYY-MM')  GROUP BY MONTHS,MM,YEARS ORDER BY YEARS,MM  LIMIT 12;

queries.queryToFetchMonthWisePatientVisitCount=SELECT COUNT (*),TO_CHAR(CREATED_DTTM, 'YYYY-MON') MONTHS,TO_CHAR(CREATED_DTTM, 'MM') MM,TO_CHAR(CREATED_DTTM, 'YYYY') YEARS FROM OPD.PATIENT_VISIT_TRANS WHERE ORG_ID=:ORG_ID AND TO_CHAR(CREATED_DTTM, 'YYYY-MM-DD')::DATE BETWEEN :CURRENT_MONTH::DATE- INTERVAL '1 YEAR'  AND :CURRENT_MONTH::DATE GROUP BY MONTHS,MM,YEARS ORDER BY YEARS,MM;

queries.queryToFetchDayWiseMaleOrFemalePatientCount=SELECT COUNT (*),DATE(POX.CREATED_DTTM) DATE FROM PUBLIC.PATIENT_ORGANISATION_XREF POX JOIN PUBLIC.PATIENT_INFO_REF PIR ON POX.PATIENT_ID=PIR.PATIENT_ID AND PIR.GENDER ILIKE :GENDER WHERE ORG_ID=:ORG_ID  AND CAST(POX.CREATED_DTTM  AS DATE) BETWEEN :CURRENT_DT :: DATE - INTERVAL '7DAYS' AND :CURRENT_DT GROUP BY DATE(POX.CREATED_DTTM) ORDER BY DATE(POX.CREATED_DTTM);

queries.queryToFetchMonthWiseMaleOrFemalePatientCount=SELECT COUNT (*),TO_CHAR(POX.CREATED_DTTM, 'YYYY-MON') MONTHS FROM PUBLIC.PATIENT_ORGANISATION_XREF POX JOIN PUBLIC.PATIENT_INFO_REF PIR ON POX.PATIENT_ID=PIR.PATIENT_ID AND PIR.GENDER ILIKE :GENDER WHERE ORG_ID=:ORG_ID AND TO_CHAR(POX.CREATED_DTTM, 'YYYY-MM-DD')::DATE BETWEEN :CURRENT_MONTH::DATE- INTERVAL '1 YEAR'  AND :CURRENT_MONTH::DATE GROUP BY MONTHS ORDER BY MONTHS;

queries.queryToFetchPatientAverageStay=SELECT DR.DEPT_NM, ROUND(AVG((DATE_PART('DAY', DISCHARGE_DT - ADMIT_DATE) + 1))) LENGTH_STAY FROM OPD.PATIENT_VISIT_TRANS PVT JOIN PUBLIC.DEPARTMENT_REF DR ON DR.DEPT_ID=PVT.DEPT_ID WHERE  ORG_ID=:ORG_ID AND VISIT_DT IS NOT NULL AND DISCHARGE_DT IS NOT NULL GROUP BY PVT.DEPT_ID,DR.DEPT_NM;

